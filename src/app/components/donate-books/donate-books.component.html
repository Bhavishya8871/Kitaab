<app-navbar></app-navbar>
<div style="display:flex; justify-content:center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="donate-container">
  
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">üìö Donate Books</h1>
    <p class="page-subtitle">Share your books with fellow readers and help grow our library collection</p>
  </div>

  <!-- Statistics Cards -->
  <section class="statistics-section">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-info">
          <span class="stat-number">{{ totalDonations }}</span>
          <span class="stat-label">Total Donations</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-info">
          <span class="stat-number">{{ pendingDonations }}</span>
          <span class="stat-label">Pending Review</span>
        </div>
      </div>

      <div class="stat-card accepted">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-info">
          <span class="stat-number">{{ acceptedDonations }}</span>
          <span class="stat-label">Accepted</span>
        </div>
      </div>

      <div class="stat-card rejected" *ngIf="rejectedDonations > 0">
        <div class="stat-icon">‚ùå</div>
        <div class="stat-info">
          <span class="stat-number">{{ rejectedDonations }}</span>
          <span class="stat-label">Rejected</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Messages -->
  <div class="messages" *ngIf="errorMessage || successMessage">
    <div class="alert alert-error" *ngIf="errorMessage">
      <strong>‚ùå Error:</strong> {{ errorMessage }}
    </div>
    <div class="alert alert-success" *ngIf="successMessage">
      <strong>‚úÖ Success:</strong> {{ successMessage }}
    </div>
  </div>

  <!-- Donation Form -->
  <section class="form-section">
    <div class="card">
      <h2 class="section-title">üìñ Donate a Book</h2>
      
      <form [formGroup]="donationForm" (ngSubmit)="onSubmitDonation()">
        <div class="form-grid">
          
          <!-- Book Title -->
          <div class="form-group">
            <label for="title" class="form-label">
              Book Title <span class="required">*</span>
            </label>
            <input
              type="text"
              id="title"
              formControlName="title"
              class="form-control"
              placeholder="Enter the book title"
              [class.error]="getFieldError('title')"
            />
            <div class="field-error" *ngIf="getFieldError('title')">
              {{ getFieldError('title') }}
            </div>
          </div>

          <!-- Author -->
          <div class="form-group">
            <label for="author" class="form-label">
              Author <span class="required">*</span>
            </label>
            <input
              type="text"
              id="author"
              formControlName="author"
              class="form-control"
              placeholder="Enter the author name"
              [class.error]="getFieldError('author')"
            />
            <div class="field-error" *ngIf="getFieldError('author')">
              {{ getFieldError('author') }}
            </div>
          </div>

          <!-- Condition -->
          <div class="form-group">
            <label for="condition" class="form-label">
              Condition <span class="required">*</span>
            </label>
            <select
              id="condition"
              formControlName="condition"
              class="form-control"
              [class.error]="getFieldError('condition')"
            >
              <option value="">Select book condition</option>
              <option *ngFor="let option of conditionOptions" [value]="option.value">
                {{ option.label }} - {{ option.description }}
              </option>
            </select>
            <div class="field-error" *ngIf="getFieldError('condition')">
              {{ getFieldError('condition') }}
            </div>
          </div>

          <!-- Quantity -->
          <div class="form-group">
            <label for="quantity" class="form-label">
              Quantity <span class="required">*</span>
            </label>
            <input
              type="number"
              id="quantity"
              formControlName="quantity"
              class="form-control"
              min="1"
              max="50"
              [class.error]="getFieldError('quantity')"
            />
            <div class="field-error" *ngIf="getFieldError('quantity')">
              {{ getFieldError('quantity') }}
            </div>
            <div class="field-hint">Maximum 50 books per donation</div>
          </div>

          <!-- Photo Upload -->
          <div class="form-group full-width">
            <label for="photo" class="form-label">
              Book Photo <span class="optional">(Optional)</span>
            </label>
            
            <div class="photo-upload-area" *ngIf="!hasPhoto()">
              <input
                type="file"
                id="photoInput"
                accept="image/*"
                (change)="onFileSelected($event)"
                class="file-input"
              />
              <label for="photoInput" class="file-label">
                <div class="upload-content">
                  <div class="upload-icon">üì∑</div>
                  <p class="upload-text">Click to upload book photo</p>
                  <p class="upload-hint">JPEG, PNG, or GIF (max 5MB)</p>
                </div>
              </label>
            </div>

            <!-- Photo Preview -->
            <div class="photo-preview" *ngIf="hasPhoto()">
              <img [src]="getPhotoPreview()" alt="Book preview" class="preview-image" />
              <button type="button" class="btn-remove-photo" (click)="removePhoto()">
                üóëÔ∏è Remove Photo
              </button>
            </div>
          </div>

          <!-- Additional Notes -->
          <div class="form-group full-width">
            <label for="notes" class="form-label">
              Additional Notes <span class="optional">(Optional)</span>
            </label>
            <textarea
              id="notes"
              formControlName="notes"
              class="form-control textarea"
              rows="3"
              placeholder="Any additional information about the book..."
              [class.error]="getFieldError('notes')"
            ></textarea>
            <div class="field-error" *ngIf="getFieldError('notes')">
              {{ getFieldError('notes') }}
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary btn-large"
            [disabled]="donationForm.invalid || isSubmitting"
          >
            <span *ngIf="isSubmitting" class="loading-spinner"></span>
            {{ isSubmitting ? 'Submitting...' : 'üìö Submit Donation' }}
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showConfirmation">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üìö Confirm Donation Submission</h3>
      </div>
      <div class="modal-body">
        <p>Please confirm your book donation details:</p>
        <div class="donation-summary">
          <div class="summary-item">
            <strong>Title:</strong> {{ donationForm.get('title')?.value }}
          </div>
          <div class="summary-item">
            <strong>Author:</strong> {{ donationForm.get('author')?.value }}
          </div>
          <div class="summary-item">
            <strong>Condition:</strong> {{ donationForm.get('condition')?.value }}
          </div>
          <div class="summary-item">
            <strong>Quantity:</strong> {{ donationForm.get('quantity')?.value }}
          </div>
          <div class="summary-item" *ngIf="hasPhoto()">
            <strong>Photo:</strong> Included
          </div>
        </div>
        <p class="confirmation-note">
          Your donation will be reviewed by our library staff. You'll receive a notification when the status changes.
        </p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="cancelSubmission()" [disabled]="isSubmitting">
          Cancel
        </button>
        <button class="btn btn-primary" (click)="confirmSubmission()" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="loading-spinner"></span>
          {{ isSubmitting ? 'Submitting...' : 'Confirm Donation' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Donations History -->
  <section class="history-section" *ngIf="!isLoading">
    <div class="card">
      <div class="section-header">
        <h2 class="section-title">üìã Your Donation History</h2>
        
        <!-- Status Filter -->
        <div class="filter-section">
          <label for="statusFilter">Filter by Status:</label>
          <select 
            id="statusFilter" 
            [(ngModel)]="statusFilter" 
            (change)="onStatusFilterChange()"
            class="filter-select"
          >
            <option value="all">All Status</option>
            <option value="pending">Pending</option>
            <option value="accepted">Accepted</option>
            <option value="rejected">Rejected</option>
          </select>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="loading-spinner large"></div>
        <p>Loading your donations...</p>
      </div>

      <!-- Donations List -->
      <div class="donations-list" *ngIf="!isLoading && filteredDonations.length > 0">
        <div 
          class="donation-item" 
          *ngFor="let donation of filteredDonations; trackBy: trackByDonationId"
        >
          <div class="donation-content">
            <div class="donation-details">
              <h4>{{ donation.title }}</h4>
              <div class="donation-info">
                <p><strong>üë§ Author:</strong> {{ donation.author }}</p>
                <p><strong>üìñ Condition:</strong> {{ donation.condition }}</p>
                <p><strong>üî¢ Quantity:</strong> {{ donation.quantity }}</p>
                <p><strong>üìÖ Submitted:</strong> {{ donation.submissionDate | date:'mediumDate' }}</p>
                <p *ngIf="donation.adminNotes"><strong>üìù Admin Notes:</strong> {{ donation.adminNotes }}</p>
              </div>
            </div>
            
            <div class="donation-photo" *ngIf="donation.photoUrl">
              <img [src]="donation.photoUrl" alt="Book photo" class="donation-thumbnail" />
            </div>
          </div>
          
          <div class="donation-status">
            <span class="status-badge" [class]="getStatusClass(donation.status)">
              {{ donation.status }}
            </span>
            <div class="status-date" *ngIf="donation.statusUpdatedDate">
              Updated: {{ donation.statusUpdatedDate | date:'shortDate' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!isLoading && filteredDonations.length === 0">
        <div class="empty-icon">üì≠</div>
        <h3>No donations found</h3>
        <p *ngIf="donations.length === 0">You haven't made any book donations yet.</p>
        <p *ngIf="donations.length > 0">No donations match your current filter.</p>
        <div class="empty-actions">
          <button class="btn btn-primary" (click)="statusFilter = 'all'; onStatusFilterChange()" *ngIf="donations.length > 0">
            Show All Donations
          </button>
        </div>
      </div>
    </div>
  </section>

  
 
</div>
</div>
